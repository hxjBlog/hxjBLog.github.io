<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/LOGO.png"><link rel="icon" href="/img/LOGO.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="hxj"><meta name="keywords" content=""><meta name="description" content="为了实现一个高频的，可控制精准占空比、多通道相位同步控制的PWM方波输出，使用了DMA MEMTOMEM用于实现GPIO口方波输出"><meta property="og:type" content="article"><meta property="og:title" content="STM32 使用DMA MEMTOMEM"><meta property="og:url" content="https://hxjblog.github.io/2023/09/10/DMA%20%E7%9A%84MEMTOMEM/index.html"><meta property="og:site_name" content="hello,hxjBLog"><meta property="og:description" content="为了实现一个高频的，可控制精准占空比、多通道相位同步控制的PWM方波输出，使用了DMA MEMTOMEM用于实现GPIO口方波输出"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/22498321/1711251231947-8d006fae-2e40-4042-9e41-bcc45e12029a.png"><meta property="article:published_time" content="2023-09-09T16:00:00.000Z"><meta property="article:modified_time" content="2023-09-22T10:00:00.000Z"><meta property="article:author" content="hxj"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2024/png/22498321/1711251231947-8d006fae-2e40-4042-9e41-bcc45e12029a.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>STM32 使用DMA MEMTOMEM - hello,hxjBLog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"hxjblog.github.io",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:70,cursorChar:" ",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!1,baidu:null,google:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},gtag:null},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 7.1.1"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>hxj</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/background.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="STM32 使用DMA MEMTOMEM"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> hxj </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-09-10 00:00" pubdate>2023年9月10日 凌晨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.2k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 19 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">STM32 使用DMA MEMTOMEM</h1><p id="updated-time" class="note note-info">本文最后更新于 2023年9月22日 晚上</p><div class="markdown-body"><p>最近有一个特殊的需求：之前进行超声脉冲激励控制时，主要采用了一款装用的双通道脉冲输出芯片，因为需要实现一个双通道互补的50%PWM脉冲输出，而且要精准的控制触发时间和占空比，同时还要控制两个通道的相位。由于目前使用的超声是10Mhz的，要实现这么<strong>高频的，可控制精准占空比、多通道相位同步控制，</strong>使用一般的方式还是有点难度的。因此需要重新考虑怎么操作。</p><h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><ol><li>超声的脉冲发生中，高压脉冲发生器STHV748需要两个高速的控制信号驱动</li></ol><p>过去使用LM96570波形发生器，用于产生控制信号。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22498321/1697354618729-5cf8aa75-42ea-4953-a279-85fbab1b17db.png" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer" alt="image.png"></p><ol start="2"><li>由于产生的超声脉冲频率达到10MHz，而每半个波长就需要产生一次控制信号，因此需要20MHz的高频控制信号，同时需要准确控制脉冲个数</li><li>STM32h7的主频使用240mhz的情况下，产生20MHz的控制方波信号，则每次切换<strong>只有12个时钟周期</strong>的时间，间隔极短，因此不能依赖传统的PWM精确脉冲控制的方式。</li><li><strong>不能使用任何中断控制等方式</strong>，同时需要考虑指令的执行时间<blockquote><p>使用STM32的中断响应的方式，需要等待至少12个时钟周期，同时完成中断响应实现中断触发-压栈-中断向量表-进入中断处理函数等过程，需要执行很多个指令的。一旦使用HAL库，或者在中断中进行其他运算，会超出需求的时间间隔，影响输出脉冲。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22498321/1697355327694-ec9c4498-0a86-4e88-8cd7-98d6817ecf48.png" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer"></p></blockquote></li></ol><p><strong>因此需要实现在无CPU参与情况下的高频指定脉冲数输出，那这就不得不使用DMA方式了~</strong></p><h1 id="DMA-基础"><a href="#DMA-基础" class="headerlink" title="DMA 基础"></a>DMA 基础</h1><p>DMA是一种允许外设和内存之间直接传输数据的技术，无需CPU的介入，从而释放CPU资源以处理其他任务。在STM32微控制器中，DMA控制器支持多种数据传输模式，包括MEMTOMEM模式，该模式允许内存区域之间直接传输数据。</p><p>DMA（Direct Memory Access）MEMTOMEM模式是DMA传输模式之一，它允许数据从一个内存区域直接传输到另一个内存区域，而不需要CPU的介入。这种模式在处理大量数据传输时特别有用，因为它可以减轻CPU的负担，提高系统的整体效率。</p><h2><a href="#" class="headerlink"></a></h2><p>在STM32微控制器中，DMA控制器支持多种传输模式，包括MEMTOMEM模式。以下是MEMTOMEM模式的详细介绍：</p><h2 id="关于DMA-MEMTOMEM模式"><a href="#关于DMA-MEMTOMEM模式" class="headerlink" title="关于DMA MEMTOMEM模式"></a>关于DMA MEMTOMEM模式</h2><h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p>在MEMTOMEM模式下，DMA控制器负责在两个内存区域之间传输数据。DMA控制器会根据预设的参数，如数据大小、传输方向、缓冲区大小等，自动处理数据的移动。CPU在初始化DMA传输后，可以执行其他任务，直到DMA传输完成。</p><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul><li><strong>无需CPU干预</strong>：一旦DMA传输开始，CPU不需要参与数据的实际移动过程。</li><li><strong>高效</strong>：DMA传输不会占用CPU周期，因此CPU可以同时处理其他任务。</li><li><strong>灵活</strong>：用户可以根据需要设置传输的数据量、方向和目标内存地址。</li><li><strong>中断支持</strong>：DMA控制器可以在传输完成或发生错误时，通过中断通知CPU。</li></ul><h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><p>要在STM32中配置DMA MEMTOMEM传输，通常需要执行以下步骤：</p><ol><li><strong>使能DMA控制器和相关外设的时钟</strong>：通过RCC（Reset and Clock Control）模块来使能DMA和需要使用DMA的外设的时钟。</li><li><strong>初始化DMA通道</strong>：通过STM32CUBEMX配置DMA通道的参数，包括内存源地址、外设目标地址、数据方向、数据大小、传输模式（如循环模式）、优先级等。</li><li><strong>设置内存源地址和外设目标地址</strong>：内存源地址指向数据的起始位置，外设目标地址通常设置为外设的控制寄存器地址，但在MEMTOMEM模式下，外设地址通常设置为一个固定的地址，如STM32中的<code>0xFFFF0800</code>，这是一个特殊的地址，用于表示内存到内存的传输。</li><li><strong>启动DMA传输</strong>：通过调用DMA_Cmd函数启用DMA传输。</li><li><strong>配置中断（可选）</strong>：如果需要，可以配置DMA中断，以便在传输完成或发生错误时得到通知。</li></ol><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>MEMTOMEM模式在以下场景中特别有用：</p><ul><li><strong>数据处理</strong>：在需要处理大量数据时，如图像处理、音频数据处理等。</li><li><strong>数据复制</strong>：从一个内存区域复制数据到另一个内存区域，例如在准备数据块以供外设使用时。</li><li><strong>实时系统</strong>：在需要快速响应和高吞吐量的实时系统中，DMA可以确保数据及时传输，同时CPU可以处理其他关键任务。</li></ul><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul><li>确保内存源地址和目标地址有效，且内存区域已经正确配置。</li><li>在MEMTOMEM模式下，外设地址通常设置为特定的值，而不是实际的外设寄存器地址。</li></ul><h2 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h2><h3 id="-1"><a href="#-1" class="headerlink"></a></h3><p>使用一个较长的数组，用于存储GPIO口的ODR寄存器数值，使用** DMA 的MEMTOMEM 实现对GPIO-&gt;ODR的直接修改**，完成对GPIO的高速以及指定脉冲数控制</p><ul><li>出现DMA state一直busy， 后发现使用HAL_DMA_Start_IT ，由于使用HAL_DMA_Start并不会清除DMA标志位，导致在normal模式下只能实现单次的脉冲，此后无脉冲输出</li></ul><p>在使用F103的情况下可以实现多个持续脉冲的输出<br><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/22498321/1697254640722-f87fc8bb-1f29-4380-834e-e268c3a23280.jpeg" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer"><br>但是使用STM32H7后出现了波形间隔的问题<br><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/22498321/1697254582072-7d47f30d-e4da-4ce2-a43b-d2f90a84d2dd.jpeg" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer"></p><p>缺点：</p><ul><li>使用该方式需要使用<strong>系统时钟AHB</strong>作为DMA直接时钟源，需要通过修改数组的具体内容实现对输出频率的调节。</li><li>同时使用H7时出现上图的波形间断的问题</li><li>原因：在H7下，使用DMA的MEMTOMEM模式下，<strong>需要使用FIFO</strong>，但是 DMA1和DMA2带的FIFO是4个32bit的空间，即16字节。因此如上图所示会在进行16次翻转（8个脉冲）后出现需要移动FIFO指针位置等操作，因此出现了时间间隔</li></ul><h3 id="-2"><a href="#-2" class="headerlink"></a></h3><p>使用定时器的TIM输出，同时配合使用DMA模式，实现高速修改TIM的CCR寄存器，用于控制PWM波的可调脉冲输出，并可以配合CH1和CH1N实现互补通道输出，方便产生控制信号<br>问题：<br>使用DMA搬运时，由于不同通道分开实现搬运，由于实验所需的<strong>脉冲搬运速度过快</strong>，会由于DMA的速度，导致不同通道存在一定的波形错开，无法实现同步的对齐，因此不可用。</p><h3 id="-3"><a href="#-3" class="headerlink"></a></h3><p>使用DMAMUX+TIM的方式实现可调频、可调波数的输出。<br>在DMAMUX下，使用指定时钟信号，触发DMA，避免通过调节系统时钟完成调频，方便了输出，结果如下<br><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/22498321/1697254712873-bf4f641e-e567-4654-bc9f-3cb147ee6cfa.jpeg" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer"></p><h4 id="DMAMUX"><a href="#DMAMUX" class="headerlink" title="DMAMUX"></a>DMAMUX</h4><p>DMAMUX取消了原先DMA模式下，只能由有限固定的触发源请求DMA，可以使用更广泛，如定时器等<br><img src="https://cdn.nlark.com/yuque/0/2023/webp/22498321/1697266274745-284eefa9-b6ad-46b4-bea2-59b7cbbbb57d.webp" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer"></p><ul><li><p><img src="https://cdn.nlark.com/yuque/0/2023/webp/22498321/1697266274745-284eefa9-b6ad-46b4-bea2-59b7cbbbb57d.webp" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer"></p><ul><li>——原先基础的DMA表</li></ul></li><li><p><img src="https://cdn.nlark.com/yuque/0/2023/webp/22498321/1697266260319-e245cd56-455b-4ddc-9c2f-6b7c1986a958.webp" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer"></p><ul><li>——使用DMAMUX后可以实现的DMA请求和功能的管理<blockquote><p>通过DMA请求生成器基于触发信号生成DMA请求，一方面可以弥补只是部分外设事件【dmamux_req_inx】才可以申请DMA传输的局限，另一方面可以将不同DMA请求借助路由器模块输出的路由事件【dmamux_evtx】关联起来，让DMA应用更为灵活并富有创意。</p></blockquote></li></ul></li><li><p>对比使用<strong>双缓冲模式和单缓冲模式</strong>，配合分别均可实现高速的脉冲输出，双缓冲模式下，脉冲输出时可以方便对数组值进行修改，即后续GPIO的状态进行调整</p></li><li><p>使用实现了正确的脉冲输出，及脉冲数控制，以及指定间隔时间下的脉冲输出</p><ul><li><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/22498321/1697280385211-a0963176-53bc-4f8e-bc51-a4095eb2fec4.jpeg" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer" alt="a61af138018bbeef639d431f52d8294.jpg"></li></ul></li><li><p>DMA改为使用定时器TIM12作为时钟源进行上升下降沿触发，这样可以只需要修改定时器的占空比，DMA只负责切换即可，即数组只是用最简单的交替切换，而不再用于控制占空比。</p></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/22498321/1697280520158-1b890cf3-eecd-46e3-8b40-3a5de0d48ff4.jpeg" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer"></p><ul><li>实测中TIM第一次触发DMA的数据会有部分时候的时长不同，因此选择先置零实现控制。</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/22498321/1697280570173-74ac419b-98c7-47ef-92a0-545d7b6e3863.jpeg" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer"></p><ul><li>从图中可以看到，已经实现了对应方波的控制了，可以先拉丁电平，再控制交替的高电平切换，以及精准脉冲数目的控制了！</li><li>相关的STM32CUBE内的配置情况如下</li><li><img src="https://cdn.nlark.com/yuque/0/2023/png/22498321/1697358370284-b0f78479-bace-47a0-b02b-ac9a6c4a71c0.png" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer" alt="image.png"></li><li><img src="https://cdn.nlark.com/yuque/0/2023/png/22498321/1697358392130-09093f63-b1d1-4ab6-8bb7-cd5cabaf7922.png" srcset="/img/loading.gif" lazyload referrerpolicy="no-referrer" alt="image.png"></li></ul></div><hr><div><div class="post-metas my-3"></div><div class="license-box my-3"><div class="license-title"><div>STM32 使用DMA MEMTOMEM</div><div>https://hxjblog.github.io/2023/09/10/DMA 的MEMTOMEM/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>hxj</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年9月10日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/10/17/%E8%82%8C%E8%82%89%E3%80%81%E9%AA%A8%E9%AA%BC%E5%AF%86%E5%BA%A6%E6%A3%80%E6%B5%8B/" title="关于肌肉、骨骼密度检测"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">关于肌肉、骨骼密度检测</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/06/08/%E5%85%B3%E4%BA%8EQt/" title="Qt分享"><span class="hidden-mobile">Qt分享</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/snowflake.min.js"></script><script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/Cherry.min.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>